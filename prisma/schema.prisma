generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Airport {
  AirportID        String    @id @db.VarChar(10)
  AirportName      String    @db.VarChar(100)
  City             String    @db.VarChar(100)
  Country          String    @db.VarChar(100)
  arrivalFlights   Flight[]  @relation("ArrivalFlights")
  departureFlights Flight[]  @relation("DepartureFlights")
  operates         Operate[]
}

model Airline {
  AirlineName      String            @id @db.VarChar(100)
  AirlineCaption   String            @db.VarChar(255)
  Website          String?           @db.VarChar(255)
  AmountOfAircraft Int
  Logo             String?           @db.VarChar(255)
  aircrafts        Aircraft[]
  messages         Airline_Message[]
  telNos           Airline_Tel_No[]
  contacts         Contact[]
  flights          Flight[]
  operates         Operate[]
}

model Aircraft {
  AircraftRegNo String       @id @db.VarChar(20)
  AirlineName   String       @db.VarChar(100)
  SeatCapacity  Int
  ModelName     String       @db.VarChar(100)
  airline       Airline      @relation(fields: [AirlineName], references: [AirlineName])
  cabins        CabinClass[]
  flights       Flight[]
}

model Flight {
  FlightNo                 String          @db.VarChar(10)
  ArrivalAirportID         String          @db.VarChar(10)
  DepartureAirportID       String          @db.VarChar(10)
  AirlineName              String          @db.VarChar(100)
  AircraftRegNo            String          @db.VarChar(20)
  ArrivalTime              DateTime
  AvailableSeat            Int
  DepartTime               DateTime
  TransitAmount            Int
  ExtraBaggage             Boolean         @default(false)
  SeatSelect               Boolean         @default(false)
  FreeCheckedBaggageBags   Int             @default(0)
  FreeCheckedBaggageWeight Int             @default(0)
  passengers               Assigned_To[]
  departCarts              Cart[]          @relation("DepartFlight")
  returnCarts              Cart[]          @relation("ReturnFlight")
  aircraft                 Aircraft        @relation(fields: [AircraftRegNo], references: [AircraftRegNo])
  airline                  Airline         @relation(fields: [AirlineName], references: [AirlineName])
  arrivalAirport           Airport         @relation("ArrivalFlights", fields: [ArrivalAirportID], references: [AirportID])
  departureAirport         Airport         @relation("DepartureFlights", fields: [DepartureAirportID], references: [AirportID])
  availableServices        FlightService[]
  departBooked             Payment[]       @relation("DepartFlight")
  returnBooked             Payment[]       @relation("ReturnFlight")
  seats                    Seat[]
  tickets                  Ticket[]

  @@id([FlightNo, DepartTime, ArrivalTime])
}

model Transit {
  FlightNo          String   @db.VarChar(10)
  DepartTime        DateTime
  ArrivalTime       DateTime
  Transit           String   @db.VarChar(20)
  durationToTransit Int

  @@id([FlightNo, DepartTime, ArrivalTime])
}

model FlightService {
  FlightNo    String   @db.VarChar(10)
  DepartTime  DateTime
  ArrivalTime DateTime
  ServiceID   String   @db.VarChar(50)
  flight      Flight   @relation(fields: [FlightNo, DepartTime, ArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  service     Service  @relation(fields: [ServiceID], references: [ServiceID])

  @@id([FlightNo, DepartTime, ArrivalTime, ServiceID])
}

model Service {
  ServiceID        String          @id @db.VarChar(50)
  ServiceName      String          @db.VarChar(100)
  Price            Float
  Description      String?
  availableFlights FlightService[]
  bookedServices   TicketService[]
}

model TicketService {
  TicketID  String  @db.VarChar(50)
  ServiceID String  @db.VarChar(50)
  Quantity  Int     @default(1)
  service   Service @relation(fields: [ServiceID], references: [ServiceID])
  ticket    Ticket  @relation(fields: [TicketID], references: [TicketID])

  @@id([TicketID, ServiceID])
}

model Ticket {
  TicketID             String             @id @default(uuid()) @db.VarChar(50)
  Price                Float
  PassengerName        String
  PassengerLastName    String
  Gender               String
  DateOfBirth          DateTime
  Nationality          String
  BaggageChecked       Float
  BaggageCabin         Float
  SeatNo               String
  AircraftRegNo        String
  FlightNo             String
  ArrivalTime          DateTime
  DepartTime           DateTime
  TicketStatus         TicketStatus       @default(SCHEDULED)
  ServiceFee           Float              @default(0)
  PassportExpiry       DateTime?
  PassportNo           String?
  purchase             Purchase?
  roundTripTicketPart2 Round_Trip_Ticket? @relation("RoundTrip2")
  roundTripTicketPart1 Round_Trip_Ticket? @relation("RoundTrip1")
  seat                 Seat               @relation(fields: [FlightNo, DepartTime, ArrivalTime, SeatNo], references: [FlightNo, DepartTime, ArrivalTime, SeatNo])
  flight               Flight             @relation(fields: [FlightNo, DepartTime, ArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  bookedServices       TicketService[]
}

model Operate {
  AirportID   String  @db.VarChar(10)
  AirlineName String  @db.VarChar(100)
  airline     Airline @relation(fields: [AirlineName], references: [AirlineName])
  airport     Airport @relation(fields: [AirportID], references: [AirportID])

  @@id([AirportID, AirlineName])
}

model Assigned_To {
  FlightNo      String   @db.VarChar(10)
  UserAccountID String   @db.VarChar(50)
  ArrivalTime   DateTime
  DepartTime    DateTime
  flight        Flight   @relation(fields: [FlightNo, DepartTime, ArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  user          User     @relation(fields: [UserAccountID], references: [UserAccountID])

  @@id([FlightNo, DepartTime, ArrivalTime, UserAccountID])
}

model Contact {
  AirlineName    String  @db.VarChar(50)
  ContactStatus  String
  AdminAccountID String  @db.VarChar(50)
  admin          Admin   @relation(fields: [AdminAccountID], references: [AdminAccountID])
  airline        Airline @relation(fields: [AirlineName], references: [AirlineName])

  @@id([AdminAccountID, AirlineName])
}

model Report_To {
  ReportStatus   String
  AdminAccountID String   @db.VarChar(50)
  UserAccountID  String   @db.VarChar(50)
  Reports        Report[] @relation("CreatedReports")
  admin          Admin    @relation(fields: [AdminAccountID], references: [AdminAccountID])
  user           User     @relation(fields: [UserAccountID], references: [UserAccountID])

  @@id([UserAccountID, AdminAccountID])
}

model CabinClass {
  AircraftRegNo String   @db.VarChar(20)
  Class         String   @db.VarChar(20)
  StandardPrice Float
  aircraft      Aircraft @relation(fields: [AircraftRegNo], references: [AircraftRegNo])

  @@id([AircraftRegNo, Class])
}

model Seat {
  SeatNo      String   @db.VarChar(10)
  SeatType    String
  IsAvailable Boolean  @default(true)
  DepartTime  DateTime
  FlightNo    String
  ArrivalTime DateTime
  flight      Flight   @relation(fields: [FlightNo, DepartTime, ArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  tickets     Ticket[]

  @@id([FlightNo, DepartTime, ArrivalTime, SeatNo])
}

model Admin {
  IPAddress           String?
  AdminAccountID      String            @id @db.VarChar(50)
  account             Account           @relation(fields: [AdminAccountID], references: [AccountID])
  sentAirlineMessages Airline_Message[]
  contacts            Contact[]
  involvedInReports   Report_To[]
}

model Airline_Message {
  AirlineName    String  @db.VarChar(100)
  MessageText    String
  AdminAccountID String  @db.VarChar(50)
  admin          Admin   @relation(fields: [AdminAccountID], references: [AdminAccountID])
  airline        Airline @relation(fields: [AirlineName], references: [AirlineName])

  @@id([AirlineName, AdminAccountID, MessageText])
}

model Account {
  Password  String
  FirstName String
  LastName  String
  Email     String @unique
  AccountID String @id @default(uuid()) @db.VarChar(50)
  admin     Admin?
  user      User?
}

model User {
  UserAccountID     String        @id @db.VarChar(50)
  assignedFlights   Assigned_To[]
  carts             Cart[]
  purchases         Purchase[]
  involvedInReports Report_To[]
  account           Account       @relation(fields: [UserAccountID], references: [AccountID])
  telNos            User_Tel_No?
}

model User_Tel_No {
  TelNo         String @db.VarChar(20)
  UserAccountID String @id @db.VarChar(50)
  user          User   @relation(fields: [UserAccountID], references: [UserAccountID])
}

model Report {
  ReportID          String    @id @db.VarChar(50)
  ReportDescription String
  Attachment        String?
  TelNo             String
  PassengerName     String
  AccountID         String
  AdminAccountID    String    @db.VarChar(50)
  UserAccountID     String    @db.VarChar(50)
  PaymentID         String    @unique
  payment           Payment   @relation(fields: [PaymentID], references: [PaymentID])
  creator           Report_To @relation("CreatedReports", fields: [UserAccountID, AdminAccountID], references: [UserAccountID, AdminAccountID])
}

model Round_Trip_Ticket {
  TicketID  String @id @db.VarChar(50)
  TicketID2 String @unique @db.VarChar(50)
  ticket2   Ticket @relation("RoundTrip2", fields: [TicketID2], references: [TicketID])
  ticket1   Ticket @relation("RoundTrip1", fields: [TicketID], references: [TicketID])
}

model Purchase {
  TicketID      String  @unique @db.VarChar(50)
  PaymentID     String  @db.VarChar(50)
  UserAccountID String  @db.VarChar(50)
  payment       Payment @relation(fields: [PaymentID], references: [PaymentID])
  ticket        Ticket  @relation(fields: [TicketID], references: [TicketID])
  user          User    @relation(fields: [UserAccountID], references: [UserAccountID])

  @@id([TicketID, PaymentID])
}

model Payment {
  PaymentID               String     @id @db.VarChar(50)
  PaymentDateTime         DateTime
  PaymentMethod           String
  TransactionStatus       String
  Amount                  Float
  PaymentEmail            String
  PaymentTelNo            String
  BankName                String?
  Adults                  Int
  Childrens               Int
  ClassType               String
  DepartFlightArrivalTime DateTime
  DepartFlightDepartTime  DateTime
  DepartFlightNo          String
  FlightType              String
  Infants                 Int
  ReturnFlightArrivalTime DateTime?
  ReturnFlightDepartTime  DateTime?
  ReturnFlightNo          String?
  CreatedAt               DateTime   @default(now())
  DepartFlight            Flight     @relation("DepartFlight", fields: [DepartFlightNo, DepartFlightDepartTime, DepartFlightArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  ReturnFlight            Flight?    @relation("ReturnFlight", fields: [ReturnFlightNo, ReturnFlightDepartTime, ReturnFlightArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  purchase                Purchase[]
  report                  Report?
}

model Airline_Tel_No {
  TelNo       String  @db.VarChar(20)
  AirlineName String  @db.VarChar(100)
  airline     Airline @relation(fields: [AirlineName], references: [AirlineName])

  @@id([TelNo, AirlineName])
}

model Cart {
  UserAccountID           String
  createdAt               DateTime  @default(now())
  DepartFlightArrivalTime DateTime
  DepartFlightDepartTime  DateTime
  DepartFlightNo          String
  ReturnFlightArrivalTime DateTime?
  ReturnFlightDepartTime  DateTime?
  ReturnFlightNo          String?
  ClassType               String
  FlightType              String
  ID                      Int       @default(autoincrement())
  Adults                  Int
  Childrens               Int
  Infants                 Int
  Price                   Int
  DepartFlight            Flight    @relation("DepartFlight", fields: [DepartFlightNo, DepartFlightDepartTime, DepartFlightArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  ReturnFlight            Flight?   @relation("ReturnFlight", fields: [ReturnFlightNo, ReturnFlightDepartTime, ReturnFlightArrivalTime], references: [FlightNo, DepartTime, ArrivalTime])
  user                    User      @relation(fields: [UserAccountID], references: [UserAccountID])

  @@id([ID, UserAccountID])
}

enum TicketStatus {
  SCHEDULED
  CANCELLED
  DEPARTED
}
